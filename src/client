#!/bin/bash

# either load for dyn or rps for static
arg=$2
source /workspace/memcached/definitions.sh

docker run -d --rm --name dc-server --net dc cloudsuite/data-caching:server -t 18 -m 65442 -n 550

case "$1" in
    dynamic)
        docker run -it --rm \
            --name dc-client \
            --net dc \
            -v $ENTRYPOINTS_DIR:/usr/local/bin \
            -v $LOAD_DIR/${arg:-load}.cfg:/load.cfg \
            -v /workspace/memcached/lat_log:/usr/src/memcached/memcached_client/logs \
            jonassa/benchmarks:dc-client \
            dynamic.sh
        ;;

    static)
        docker run -it --rm \
            --name dc-client \
            --net dc \
            -v $ENTRYPOINTS_DIR:/usr/local/bin \
            -v /workspace/memcached/lat_log:/usr/src/memcached/memcached_client/logs \
            jonassa/benchmarks:dc-client \
            static.sh $arg
        ;;

    extended)
        docker run -it --rm \
            --name dc-client \
            --net dc \
            -v $ENTRYPOINTS_DIR:/usr/local/bin \
            -v /workspace/memcached/lat_log:/usr/src/memcached/memcached_client/logs \
            jonassa/benchmarks:dc-client \
            extended.sh $arg
        ;;

    shell)
        docker run -it --rm \
            --name dc-client \
            --net dc \
            -v /workspace/memcached/lat_log:/usr/src/memcached/memcached_client/logs \
            jonassa/benchmarks:dc-client bash
        ;;

    mount)
        docker run -it --rm \
            --name dc-client \
            --net dc \
            -v $ENTRYPOINTS_DIR:/usr/local/bin \
            -v $LOAD_DIR/load.cfg:/load.cfg \
            -v /workspace/memcached/lat_log:/usr/src/memcached/memcached_client/logs \
            jonassa/benchmarks:dc-client bash
        ;;

    *)
        docker run -it --rm \
            --name dc-client \
            --net dc \
            jonassa/benchmarks:dc-client
        ;;
esac

docker kill dc-server
